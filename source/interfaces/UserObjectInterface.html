<!DOCTYPE html><head><meta charset="UTF-8"><title>UserObjectInterface.md|RACCOON</title><link rel="icon" type="image/x-icon" href="../../media/raccoon_icon.png" sizes="16x16 32x32 64x64 128x128"></link><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script><script type="text/javascript" src="../../contrib/plotly/plotly.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://hugary1995.github.io/raccoon/index.html" class="left moose-logo hide-on-med-and-down">RACCOON</a><a href="https://github.com/hugary1995/raccoon" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="../../install/index.html">Install</a></li><li class="moose-mega-menu-trigger" data-target="6b981739-5085-46e9-9651-6da85f745648"><a>Benchmarks<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../theory/index.html">Theory</a></li><li><a href="../../modules/index.html">Modules</a></li><li><a href="../../syntax/index.html">Syntax</a></li></ul><a href="#" class="sidenav-trigger" data-target="6f4c2445-3852-4eaa-aa5f-6881f41a3eb2"><i class="material-icons">menu</i></a><ul class="sidenav" id="6f4c2445-3852-4eaa-aa5f-6881f41a3eb2"><li><a href="../../install/index.html">Install</a></li><li><a href="../../benchmarks.menu.html">Benchmarks</a></li><li><a href="../../theory/index.html">Theory</a></li><li><a href="../../modules/index.html">Modules</a></li><li><a href="../../syntax/index.html">Syntax</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="moose-mega-menu-content" id="6b981739-5085-46e9-9651-6da85f745648"><div class="moose-mega-menu-wrapper"><div class="row row"><div class="col s12 m6 l4"><h2 id="mode-i-crack-propagation"><a href="../../benchmarks/mode1.html">Mode I crack propagation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/mode1.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div><div class="col s12 m6 l4"><h2 id="mode-ii-crack-propagation"><a href="../../benchmarks/mode2.html">Mode II crack propagation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/mode2.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div><div class="col s12 m6 l4"><h2 id="soil-desiccation"><a href="../../benchmarks/mud.html">Soil desiccation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/soil.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div></div></div></div><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="https://hugary1995.github.io/raccoon/index.html" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">interfaces</span><a href="#" class="breadcrumb">UserObjectInterface</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="3dd15eec-ea94-4ab0-911e-f49b4ed00d58" data-section-level="1" data-section-text="UserObjectInterface"><h1 id="userobjectinterface">UserObjectInterface</h1><p>The UserObjectInterface defines the methods used for retrieving const references to the specific types of UserObjects. This is done with templated methods so that use of the UserObject does not require a dynamic cast. Many objects in MOOSE support the retrieval of these references so that custom UserObject APIs may be used in calculations. UserObjects are generally executed after most other systems in MOOSE so these values are often lagged when being used in another calculation.</p><section class="scrollspy" id="90b0ba39-2bf5-44a5-87fe-ec6da71d9fb2" data-section-level="2" data-section-text="End Use API"><h2 id="end-use-api">End Use API</h2><p>Most objects in MOOSE will retrieve UserObjects through special macro functions found here:</p><pre class="moose-pre"><code class="language-cpp">
#pragma once

// MOOSE includes
#include &quot;FEProblemBase.h&quot;
#include &quot;MooseTypes.h&quot;

// Forward declarations
class InputParameters;
class UserObject;

/**
 * Interface for objects that need to use UserObjects.
 */
class UserObjectInterface
{
public:
  /**
   * @param params The parameters used by the object being instantiated. This
   *        class needs them so it can get the user object named in the input file,
   *        but the object calling getUserObject only needs to use the name on the
   *        left hand side of the statement &quot;user_object = user_object_name&quot;
   */
  UserObjectInterface(const MooseObject * moose_object);

  /**
   * Get an user object with a given parameter name
   * @param name The name of the parameter key of the user object to retrieve
   * @return The user object with name associated with the parameter &#x27;name&#x27;
   */
  template &lt;class T&gt;
  const T &amp; getUserObject(const std::string &amp; name) const;

  /**
   * Get an user object with a given name
   * @param name The name of the user object to retrieve
   * @return The user object with the name
   */
  template &lt;class T&gt;
  const T &amp; getUserObjectByName(const std::string &amp; name) const;

  /**
   * Get an user object with a given parameter name
   * @param name The name of the parameter key of the user object to retrieve
   * @return The user object with name associated with the parameter &#x27;name&#x27;
   */
  const UserObject &amp; getUserObjectBase(const std::string &amp; name) const;

  /**
   * Get an user object with a given name
   * @param name The name of the user object to retrieve
   * @return The user object with the name
   */
  const UserObject &amp; getUserObjectBaseByName(const std::string &amp; name) const;

private:
  /// Parameters of the object with this interface
  const InputParameters &amp; _uoi_params;

  /// Reference to the FEProblemBase instance
  FEProblemBase &amp; _uoi_feproblem;

  /// Thread ID
  THREAD_ID _uoi_tid;

  /// Check if the threaded copy of the user object is needed
  bool needThreadedCopy(const UserObject &amp; uo) const;
};

template &lt;class T&gt;
const T &amp;
UserObjectInterface::getUserObject(const std::string &amp; name) const
{
  unsigned int tid = needThreadedCopy(getUserObjectBase(name)) ? _uoi_tid : 0;
  return _uoi_feproblem.getUserObject&lt;T&gt;(_uoi_params.get&lt;UserObjectName&gt;(name), tid);
}

template &lt;class T&gt;
const T &amp;
UserObjectInterface::getUserObjectByName(const std::string &amp; name) const
{
  unsigned int tid = needThreadedCopy(getUserObjectBaseByName(name)) ? _uoi_tid : 0;
  return _uoi_feproblem.getUserObject&lt;T&gt;(name, tid);
}
</code></pre><a href="#abdaaf38-dd20-4af1-b8bb-c11aed8d063b" class="modal-trigger">(moose/framework/include/userobject/UserObjectInterface.h)</a><div class="modal moose-modal" id="abdaaf38-dd20-4af1-b8bb-c11aed8d063b"><div class="modal-content"><h4>/home/travis/build/hugary1995/raccoon/moose/framework/include/userobject/UserObjectInterface.h</h4><pre class="moose-pre"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#pragma once

// MOOSE includes
#include &quot;FEProblemBase.h&quot;
#include &quot;MooseTypes.h&quot;

// Forward declarations
class InputParameters;
class UserObject;

/**
 * Interface for objects that need to use UserObjects.
 */
class UserObjectInterface
{
public:
  /**
   * @param params The parameters used by the object being instantiated. This
   *        class needs them so it can get the user object named in the input file,
   *        but the object calling getUserObject only needs to use the name on the
   *        left hand side of the statement &quot;user_object = user_object_name&quot;
   */
  UserObjectInterface(const MooseObject * moose_object);

  /**
   * Get an user object with a given parameter name
   * @param name The name of the parameter key of the user object to retrieve
   * @return The user object with name associated with the parameter &#x27;name&#x27;
   */
  template &lt;class T&gt;
  const T &amp; getUserObject(const std::string &amp; name) const;

  /**
   * Get an user object with a given name
   * @param name The name of the user object to retrieve
   * @return The user object with the name
   */
  template &lt;class T&gt;
  const T &amp; getUserObjectByName(const std::string &amp; name) const;

  /**
   * Get an user object with a given parameter name
   * @param name The name of the parameter key of the user object to retrieve
   * @return The user object with name associated with the parameter &#x27;name&#x27;
   */
  const UserObject &amp; getUserObjectBase(const std::string &amp; name) const;

  /**
   * Get an user object with a given name
   * @param name The name of the user object to retrieve
   * @return The user object with the name
   */
  const UserObject &amp; getUserObjectBaseByName(const std::string &amp; name) const;

private:
  /// Parameters of the object with this interface
  const InputParameters &amp; _uoi_params;

  /// Reference to the FEProblemBase instance
  FEProblemBase &amp; _uoi_feproblem;

  /// Thread ID
  THREAD_ID _uoi_tid;

  /// Check if the threaded copy of the user object is needed
  bool needThreadedCopy(const UserObject &amp; uo) const;
};

template &lt;class T&gt;
const T &amp;
UserObjectInterface::getUserObject(const std::string &amp; name) const
{
  unsigned int tid = needThreadedCopy(getUserObjectBase(name)) ? _uoi_tid : 0;
  return _uoi_feproblem.getUserObject&lt;T&gt;(_uoi_params.get&lt;UserObjectName&gt;(name), tid);
}

template &lt;class T&gt;
const T &amp;
UserObjectInterface::getUserObjectByName(const std::string &amp; name) const
{
  unsigned int tid = needThreadedCopy(getUserObjectBaseByName(name)) ? _uoi_tid : 0;
  return _uoi_feproblem.getUserObject&lt;T&gt;(name, tid);
}
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><p>Typical usage looks like this:</p><pre class="moose-pre"><code class="language-cpp">    _elem_uo(getUserObject&lt;ElementUOProvider&gt;(&quot;element_user_object&quot;)),
</code></pre><a href="#dd08efaf-8954-4f60-8f3e-036e7b2c573c" class="modal-trigger">(moose/test/src/auxkernels/ElementUOAux.C)</a><div class="modal moose-modal" id="dd08efaf-8954-4f60-8f3e-036e7b2c573c"><div class="modal-content"><h4>/home/travis/build/hugary1995/raccoon/moose/test/src/auxkernels/ElementUOAux.C</h4><pre class="moose-pre"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;ElementUOAux.h&quot;
#include &quot;ElementUOProvider.h&quot;

registerMooseObject(&quot;MooseTestApp&quot;, ElementUOAux);

InputParameters
ElementUOAux::validParams()
{
  InputParameters params = AuxKernel::validParams();
  params.addRequiredParam&lt;UserObjectName&gt;(&quot;element_user_object&quot;,
                                          &quot;The ElementUOProvider where this Aux pulls values from&quot;);

  params.addParam&lt;std::string&gt;(&quot;field_name&quot;,
                               &quot;The field name to retrieve from the ElementUOProvider&quot;);

  MooseEnum field_type(&quot;long Real&quot;, &quot;long&quot;);
  params.addParam&lt;MooseEnum&gt;(&quot;field_type&quot;, field_type, &quot;The type of field to retrieve&quot;);

  params.set&lt;ExecFlagEnum&gt;(&quot;execute_on&quot;) = EXEC_TIMESTEP_BEGIN;
  params.addClassDescription(&quot;Aux Kernel to display generic spatial (elemental) information from a &quot;
                             &quot;UserObject that satisfies the underlying ElementUOProvider &quot;
                             &quot;interface.&quot;);
  return params;
}

ElementUOAux::ElementUOAux(const InputParameters &amp; params)
  : AuxKernel(params),
    // doco-get-user-object-begin
    _elem_uo(getUserObject&lt;ElementUOProvider&gt;(&quot;element_user_object&quot;)),
    // doco-get-user-object-end
    _field_name(isParamValid(&quot;field_name&quot;) ? getParam&lt;std::string&gt;(&quot;field_name&quot;) : &quot;default&quot;),
    _field_type(getParam&lt;MooseEnum&gt;(&quot;field_type&quot;))
{
  if (isNodal())
    mooseError(&quot;This AuxKernel only supports Elemental fields&quot;);
}

Real
ElementUOAux::computeValue()
{
  if (_field_type == &quot;long&quot;)
  {
    auto value = _elem_uo.getElementalValueLong(_current_elem-&gt;id(), _field_name);
    if (value == std::numeric_limits&lt;unsigned long&gt;::max())
      return -1.0;
    else
      return value;
  }
  else
    return _elem_uo.getElementalValueReal(_current_elem-&gt;id(), _field_name);
}
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#90b0ba39-2bf5-44a5-87fe-ec6da71d9fb2" class="tooltipped" data-position="left" data-tooltip="End Use API">End Use API</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>