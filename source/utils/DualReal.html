<!DOCTYPE html><head><meta charset="UTF-8"><title>DualReal.md|RACCOON</title><link rel="icon" type="image/x-icon" href="../../media/raccoon_icon.png" sizes="16x16 32x32 64x64 128x128"></link><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script><script type="text/javascript" src="../../contrib/plotly/plotly.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://hugary1995.github.io/raccoon/index.html" class="left moose-logo hide-on-med-and-down">RACCOON</a><a href="https://github.com/hugary1995/raccoon" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="../../install/index.html">Install</a></li><li class="moose-mega-menu-trigger" data-target="428c3677-a5b1-442c-a36b-f82330a20f3c"><a>Benchmarks<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../theory/index.html">Theory</a></li><li><a href="../../modules/index.html">Modules</a></li><li><a href="../../syntax/index.html">Syntax</a></li></ul><a href="#" class="sidenav-trigger" data-target="6a42d555-e7b4-4896-b454-38b0025cd9e7"><i class="material-icons">menu</i></a><ul class="sidenav" id="6a42d555-e7b4-4896-b454-38b0025cd9e7"><li><a href="../../install/index.html">Install</a></li><li><a href="../../benchmarks.menu.html">Benchmarks</a></li><li><a href="../../theory/index.html">Theory</a></li><li><a href="../../modules/index.html">Modules</a></li><li><a href="../../syntax/index.html">Syntax</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="moose-mega-menu-content" id="428c3677-a5b1-442c-a36b-f82330a20f3c"><div class="moose-mega-menu-wrapper"><div class="row row"><div class="col s12 m6 l4"><h2 id="mode-i-crack-propagation"><a href="../../benchmarks/mode1.html">Mode I crack propagation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/mode1.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div><div class="col s12 m6 l4"><h2 id="mode-ii-crack-propagation"><a href="../../benchmarks/mode2.html">Mode II crack propagation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/mode2.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div><div class="col s12 m6 l4"><h2 id="soil-desiccation"><a href="../../benchmarks/mud.html">Soil desiccation <i class="material-icons moose-inline-icon">link</i></a></h2><img src="../../media/soil.gif" class="materialboxed moose-image" style="width:75%;float:left;padding-top:2.5%;"></img><p></p></div></div></div></div><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="https://hugary1995.github.io/raccoon/index.html" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">utils</span><a href="#" class="breadcrumb">DualReal</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="05bc070f-a3cd-4d0a-9c93-cd048a9f59eb" data-section-level="1" data-section-text="DualReal"><h1 id="dualreal">DualReal</h1><p><code>DualReal</code> is the type underpinning all of MOOSE&#x27;s automatic differentiation (AD) capabilities.</p><p><a href="DualReal.html#overview">Overview</a> <a href="DualReal.html#timings">AD-Related Timings</a></p><section class="scrollspy" id="bacecd52-40a5-4d55-890b-fd81b8f7b2a6" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p><code>DualReal</code> is a MOOSE typedef defined from the <a href="https://github.com/roystgnr/metaphysicl"><code>MetaPhysicL</code></a> template class <code>DualNumber</code>. <code>DualNumber</code> takes two template arguments <code>T</code> and <code>D</code>; <code>T</code> represents the &quot;value&quot; type of the <code>DualNumber</code>, e.g. the type of <span tex="f(\vec{x})" bookmark="moose-equation-835f5e03-ae83-41a3-b856-cb496bc6118d" recursive="True" class="moose-katex-inline-equation" id="moose-equation-835f5e03-ae83-41a3-b856-cb496bc6118d"><script>var element = document.getElementById("moose-equation-835f5e03-ae83-41a3-b856-cb496bc6118d");katex.render("f(\\vec{x})", element, {displayMode:false,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\normal":"\\bs{n}","\\divergence":"\\nabla \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\dArea":"\\text{ d}A","\\dVolume":"\\text{ d}V","\\total":"\\text{total}","\\internal":"\\text{internal}","\\external":"\\text{external}","\\elastic":"\\text{elastic}","\\fracture":"\\text{fracture}","\\critical":"\\text{critical}","\\activeenergy":"{\\left< A \\right>}","\\inactiveenergy":"{\\left< I \\right>}","\\Gc":"\\mathcal{G}_c","\\strain":"\\bs{\\varepsilon}","\\stress":"\\bs{\\sigma}","\\xstress":"\\widetilde{\\stress}","\\macaulay":"\\left<#1\\right>","\\body":"\\Omega","\\bodyboundary":"\\partial\\body","\\grad":"\\bs{\\nabla}"}});</script></span>, while <code>D</code> represents the derivative type of the <code>DualNumber</code>, e.g. the type of <span tex="\nabla f = \frac{\partial f}{\partial\vec{x}}" bookmark="moose-equation-0cbad6b7-87ce-4211-bfc2-f551a7012cc0" recursive="True" class="moose-katex-inline-equation" id="moose-equation-0cbad6b7-87ce-4211-bfc2-f551a7012cc0"><script>var element = document.getElementById("moose-equation-0cbad6b7-87ce-4211-bfc2-f551a7012cc0");katex.render("\\nabla f = \\frac{\\partial f}{\\partial\\vec{x}}", element, {displayMode:false,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\normal":"\\bs{n}","\\divergence":"\\nabla \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\dArea":"\\text{ d}A","\\dVolume":"\\text{ d}V","\\total":"\\text{total}","\\internal":"\\text{internal}","\\external":"\\text{external}","\\elastic":"\\text{elastic}","\\fracture":"\\text{fracture}","\\critical":"\\text{critical}","\\activeenergy":"{\\left< A \\right>}","\\inactiveenergy":"{\\left< I \\right>}","\\Gc":"\\mathcal{G}_c","\\strain":"\\bs{\\varepsilon}","\\stress":"\\bs{\\sigma}","\\xstress":"\\widetilde{\\stress}","\\macaulay":"\\left<#1\\right>","\\body":"\\Omega","\\bodyboundary":"\\partial\\body","\\grad":"\\bs{\\nabla}"}});</script></span>. <code>MetaPhysicL</code> offers several options for <code>D</code> types, including:</p><ol class="browser-default" start="1"><li><p><code>NumberArray</code>  - C-array as underlying derivative vector storage for data  - Fast because of static storage  - Inflexible; no storage of indices so no sparse support. Essentially pick a    maximum possible storage size and hope for the best. Doesn&#x27;t work out for    many 3D problems or problems with a lot of variables </p></li><li><p><code>DynamicSparseNumberArray</code>  - <code>std::vector</code> as underlying storage for derivative data and indices  - Maximum flexibility  - Slow because of continual dynamic allocation of memory </p></li><li><p><code>SemiDynamicSparseNumberArray</code>  - <code>std::array</code> as underlying storage for derivative data and indices  - Fast because of static storage  - Indice storage allows sparse operations and hence flexibility  - Avoid looping over the whole size of the std::array by    maintaining a dynamic size data member</p></li></ol><p>The default configuration in MOOSE uses <code>NumberArray</code> for derivative storage because it is generally the fastest container (albeit inflexible). <code>SemiDynamicSparseNumberArray</code> can be selected as the derivative storage type by running <code>./configure --with-derivative-type=sparse</code> in MOOSE&#x27;s framework directory. The underlying derivative storage array size for both <code>NumberArray</code> and <code>SemiDynamicSparseNumberArray</code> can be modified by running <code>configure</code> with the option <code>--with-derivative-size=&lt;n&gt;</code> where <code>&lt;n&gt;</code> is the desired size of the container. By default, MOOSE is configured <code>--with-derivative-size=50</code>.</p></section><section class="scrollspy" id="4da007f1-cada-4b9a-9f11-ea19a9421f75" data-section-level="2" data-section-text="AD - Related Timings"><h2 id="timings">AD-Related Timings</h2><p><a href="DualReal.html#stabilized_ins">Stabilized Incompressible Navier Stokes</a></p><section id="21e365f4-d9f4-461e-b098-545e462f5bf0" data-section-level="3" data-section-text="Stabilized Incompressible Navier Stokes"><h3 id="stabilized_ins">Stabilized Incompressible Navier Stokes</h3><section id="36b6994b-13a6-4fbc-85a1-5a6b879e9b7c" data-section-level="4" data-section-text="Test specs"><h4 id="test-specs">Test specs</h4><ul class="browser-default"><li><p>Navier-Stokes test directory input file: <code>ad_lid_driven_stabilized.i</code> </p></li><li><p>200x200 mesh </p></li><li><p>default backing array size of 50 </p></li><li><p>Computer specs:   - MacBook Pro running Mojave 10.14.5   - 2.4 GHz Intel Core i9   - 32 GB 2400 MHz DDR4</p></li></ul></section><section id="1ac45d35-2dca-4fb3-95bc-0e7e430d5fdf" data-section-level="4" data-section-text="SNESComputeJacobian timing"><h4 id="snescomputejacobian-timing">SNESComputeJacobian timing</h4><ul class="browser-default"><li><p>MOOSE non-sparse config: 9.61 seconds </p></li><li><p>MOOSE sparse config: 9.22 seconds</p></li></ul></section></section></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#bacecd52-40a5-4d55-890b-fd81b8f7b2a6" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#4da007f1-cada-4b9a-9f11-ea19a9421f75" class="tooltipped" data-position="left" data-tooltip="AD - Related Timings">AD - Related Timings</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>